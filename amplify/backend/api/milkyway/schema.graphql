# This "input" configures a global authorization rule to enable public access to
# all models in this schema. Learn more about authorization rules here: https://docs.amplify.aws/cli/graphql/authorization-rules
#input AMPLIFY { globalAuthRule: AuthRule = { allow: public } } # FOR TESTING ONLY!

enum petState {
    ACTIVE
    INACTIVE
}

type Pet @model (mutations: {create: "createPet", update: "updatePet"})
@auth(
    rules: [
        { allow: owner},
        { allow: private, operations: [read]}
    ])

{
    id: ID! @primaryKey(sortKeyFields: ["SK"])
    SK: String!
    profilePic: String
    name: String @index(name: "byName", queryField: "petByName", sortKeyFields: ["id"])
    birthday: String
    deathDay: String
    lastWord: String
    accessLevel: String @index (name: "byAccessLevel", queryField: "petsByAccessLevel")
    state: petState
    deathCause: String
    petType: String
    managerID: ID! @index(name: "byUser", queryField: "petsByUser")
}

type PetIntroduction @model (queries: {get: "getIntroductionMessage"})
@auth(
    rules: [
        { allow: owner},
        { allow: private, operations: [read]}
    ])
{
    petID: ID! @primaryKey
    introductionMsg: String!
}

type PetFamily @model (queries: {get: "getPetFamily"},
    mutations: {create: "createPetFamily", delete: "deletePetFamily"})
@auth(
    rules: [
        { allow: owner},
        { allow: private, operations: [read]}
    ])
{
    petID: ID! @primaryKey(sortKeyFields: ["familyMemberID"])
    familyMemberID: ID!
}

enum userState {
    ACTIVE
    INACTIVE
}

type User @model(queries: {get: "getUser"}, mutations: {create: "createUser", update: "updateUser"}, subscriptions: null)
@auth(
    rules: [
        { allow: owner},
        { allow: private, operations: [read]}
    ])
{
    id: ID! @primaryKey
    profilePic: String
    name: String!
    state: userState!
    petList: [Pet] @hasMany(indexName: "byUser", fields: ["id"])
}

enum letterAccessLevel {
    PRIVATE
    PUBLIC
}

type Letter @model
@auth(
    rules: [
        { allow: owner},
        { allow: private, operations: [read]}
    ])
{
    id: ID!
    petID: ID! @primaryKey(sortKeyFields:["createdAt", "id"])
    title: String!
    relationship: String!
    content: String!
    createdAt: String!
    author: User @hasOne
    accessLevel: letterAccessLevel!
}